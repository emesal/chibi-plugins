#!/usr/bin/env -S uv run --quiet --script
# /// script
# requires-python = ">=3.10"
# dependencies = [
#     "ddgs",
# ]
# ///
"""
Web search using DuckDuckGo (no API key required)
Requires: uv (https://docs.astral.sh/uv/) - deps managed automatically
"""

import sys
import json
import os

if len(sys.argv) > 1 and sys.argv[1] == "--schema":
    print(json.dumps({
        "name": "web_search",
        "description": "Search the web using DuckDuckGo and return results",
        "parameters": {
            "type": "object",
            "properties": {
                "query": {
                    "type": "string",
                    "description": "The search query"
                },
                "max_results": {
                    "type": "integer",
                    "description": "Maximum number of results (default: 5)"
                }
            },
            "required": ["query"]
        }
    }))
    sys.exit(0)

# Read args from stdin
params = json.load(sys.stdin)

query = params.get("query")
max_results = params.get("max_results", 5)

if not query:
    print("Error: query parameter is required", file=sys.stderr)
    sys.exit(1)

from ddgs import DDGS

try:
    with DDGS() as ddgs:
        results = list(ddgs.text(query, max_results=max_results))

    output = []
    for r in results:
        output.append({
            "title": r.get("title", ""),
            "url": r.get("href", ""),
            "snippet": r.get("body", "")
        })

    print(json.dumps(output, indent=2))

except Exception as e:
    print(f"Error: {e}", file=sys.stderr)
    sys.exit(1)
